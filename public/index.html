<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1a1915">
  <title>Claude Code Web Terminal for Mobile</title>

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/icon.svg">
  <link rel="icon" type="image/svg+xml" href="/icons/icon.svg">

  <!-- xterm.js 6.0.0 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@xterm/xterm@6.0.0/css/xterm.css">
  <script src="https://cdn.jsdelivr.net/npm/@xterm/xterm@6.0.0/lib/xterm.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.11.0/lib/addon-fit.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-unicode11@0.8.0/lib/addon-unicode11.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-web-links@0.12.0/lib/addon-web-links.js"></script>

  <!-- Marked (Markdown Parser) -->
  <script src="https://cdn.jsdelivr.net/npm/marked@15/marked.min.js"></script>

  <!-- Highlight.js (Syntax Highlighting) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/styles/github-dark.min.css">
  <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11/build/highlight.min.js"></script>

  <!-- Lucide Icons -->
  <script src="https://cdn.jsdelivr.net/npm/lucide@0.460.0/dist/umd/lucide.min.js"></script>

  <!-- Socket.io -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- カスタムスタイル -->
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <!-- トースト通知コンテナ -->
  <div id="toast-container" role="alert" aria-live="polite"></div>

  <!-- オフラインバナー -->
  <div id="offline-banner" class="hidden" role="alert" aria-live="assertive">
    <span>オフライン - 接続が切断されました</span>
    <button id="reconnect-btn" aria-label="再接続する">再接続</button>
  </div>

  <!-- セッション管理パネル -->
  <div id="session-manager" class="hidden" role="dialog" aria-labelledby="session-manager-title">
    <div class="session-manager-content">
      <h2 id="session-manager-title">セッション</h2>
      <div id="session-list" role="list" aria-label="セッション一覧"></div>
      <button id="new-session-btn" class="session-btn new-btn" aria-label="新しいセッションを作成">新しいセッション</button>
    </div>
  </div>

  <!-- ターミナルコンテナ -->
  <div id="terminal-container">
    <div id="terminal"></div>
  </div>

  <!-- チャット入力バー（常時表示） -->
  <div id="chat-input-bar" role="region" aria-label="チャット入力">
    <textarea id="chat-input" rows="1" placeholder="メッセージを入力..." aria-label="チャットメッセージ"></textarea>
    <button id="chat-send-btn" aria-label="送信">
      <i data-lucide="send" class="icon"></i>
    </button>
  </div>

  <!-- 特殊キーツールバー -->
  <div id="special-keys-toolbar" role="toolbar" aria-label="特殊キー入力">
    <button class="key-btn scroll-btn" id="scroll-mode-btn" title="スクロールモード (Ctrl+b [)" aria-label="スクロールモード切り替え" aria-pressed="false">
      <i data-lucide="scroll-text" class="icon"></i>
    </button>
    <button class="key-btn settings-btn" id="settings-toggle" aria-label="設定を開く">
      <i data-lucide="settings" class="icon"></i>
    </button>
    <button class="key-btn image-btn" id="image-upload-btn" title="画像をアップロード" aria-label="画像をアップロード">
      <i data-lucide="image-plus" class="icon"></i>
    </button>
    <button class="key-btn fm-btn" id="fm-btn" title="ファイルマネージャー" aria-label="ファイルマネージャー">
      <i data-lucide="folder" class="icon"></i>
    </button>
    <button class="key-btn" data-key="Escape" aria-label="Escape">Esc</button>
    <button class="key-btn" data-key="Tab" aria-label="Tab">Tab</button>
    <button class="key-btn" data-key="ShiftTab" aria-label="Shift+Tab">⇧Tab</button>
    <button class="key-btn" data-key="Enter" aria-label="Enter">Enter</button>

    <button class="key-btn arrow-btn" data-key="ArrowUp" aria-label="上矢印">
      <i data-lucide="chevron-up" class="icon"></i>
    </button>
    <button class="key-btn arrow-btn" data-key="ArrowDown" aria-label="下矢印">
      <i data-lucide="chevron-down" class="icon"></i>
    </button>
    <button class="key-btn arrow-btn" data-key="ArrowLeft" aria-label="左矢印">
      <i data-lucide="chevron-left" class="icon"></i>
    </button>
    <button class="key-btn arrow-btn" data-key="ArrowRight" aria-label="右矢印">
      <i data-lucide="chevron-right" class="icon"></i>
    </button>
    <button class="key-btn" data-key="PageUp" aria-label="Page Up">PgUp</button>
    <button class="key-btn" data-key="PageDown" aria-label="Page Down">PgDn</button>
    <button class="key-btn" data-ctrl="c" aria-label="Ctrl+C (中断)">^C</button>
    <button class="key-btn" data-ctrl="d" aria-label="Ctrl+D (EOF)">^D</button>
    <button class="key-btn" data-ctrl="l" aria-label="Ctrl+L (クリア)">^L</button>
    <button class="key-btn" data-ctrl="z" aria-label="Ctrl+Z (サスペンド)">^Z</button>
  </div>

  <!-- セッションタブバー -->
  <div id="session-tab-bar" role="tablist" aria-label="セッション切り替え">
    <div id="session-tabs" class="session-tabs-container"></div>
    <button id="add-session-tab" class="tab-add-btn" aria-label="新しいセッション">
      <i data-lucide="plus" class="icon"></i>
    </button>
  </div>

  <!-- ステータスバー -->
  <footer id="status-bar" role="status" aria-live="polite">
    <span id="connection-indicator" aria-hidden="true"></span>
    <span id="status-text">接続中...</span>
    <span id="usage-indicator" class="usage-indicator hidden" role="button" tabindex="0" aria-label="Claude Code使用量">
      <span class="usage-item-inline"><span class="usage-label-inline">5h</span><span id="usage-5h" class="usage-value">--</span></span>
      <span class="usage-sep">|</span>
      <span class="usage-item-inline"><span class="usage-label-inline">7d</span><span id="usage-7d" class="usage-value">--</span></span>
      <button id="usage-refresh" class="usage-refresh-btn" aria-label="使用量を更新">
        <i data-lucide="refresh-cw" class="icon"></i>
      </button>
    </span>
  </footer>

  <!-- コピーボタン（フローティング） -->
  <button id="copy-btn" class="hidden" aria-label="選択したテキストをコピー">
    <i data-lucide="copy" class="icon"></i>
    <span>コピー</span>
  </button>

  <!-- 設定パネル -->
  <aside id="settings-panel" class="hidden" role="dialog" aria-labelledby="settings-title" aria-modal="true">
    <div class="settings-header">
      <span id="settings-title">設定</span>
      <button id="settings-close" aria-label="設定を閉じる">
        <i data-lucide="x" class="icon"></i>
      </button>
    </div>
    <div class="settings-content">
      <div class="setting-item">
        <label id="theme-label">テーマ</label>
        <div class="theme-toggle" role="group" aria-labelledby="theme-label">
          <button class="theme-btn" id="theme-light" data-theme="light" aria-label="ライトテーマに切り替え">
            <i data-lucide="sun" class="icon"></i>
            <span>ライト</span>
          </button>
          <button class="theme-btn active" id="theme-dark" data-theme="dark" aria-label="ダークテーマに切り替え">
            <i data-lucide="moon" class="icon"></i>
            <span>ダーク</span>
          </button>
        </div>
      </div>
      <div class="setting-item">
        <label id="fontsize-label">フォントサイズ</label>
        <div class="font-size-controls" role="group" aria-labelledby="fontsize-label">
          <button id="font-decrease" aria-label="フォントサイズを小さくする">
            <i data-lucide="minus" class="icon"></i>
          </button>
          <span id="font-size-display" aria-live="polite">14px</span>
          <button id="font-increase" aria-label="フォントサイズを大きくする">
            <i data-lucide="plus" class="icon"></i>
          </button>
        </div>
      </div>
      <div class="setting-item usage-section">
        <label id="usage-label">Claude Code 使用状況</label>
        <div id="claude-usage-container" aria-labelledby="usage-label">
          <div class="usage-loading">読み込み中...</div>
        </div>
        <button id="refresh-usage-btn" class="refresh-btn" aria-label="使用状況を更新">
          <i data-lucide="refresh-cw" class="icon"></i>
          <span>更新</span>
        </button>
      </div>
      <!-- セッション操作 -->
      <div class="setting-item session-section">
        <label id="session-label">セッション</label>
        <button id="detach-session-btn" class="session-control-btn" aria-label="現在のセッションから切断してセッション一覧へ戻る">
          <i data-lucide="log-out" class="icon"></i>
          <span>切断してセッション一覧へ</span>
        </button>
      </div>
    </div>
  </aside>
  <div id="settings-overlay" class="hidden" aria-hidden="true"></div>

  <!-- ペーストモーダル -->
  <div id="paste-modal" class="modal hidden" role="dialog" aria-labelledby="paste-modal-title" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header" id="paste-modal-title">ペーストするテキストを入力</div>
      <textarea id="paste-textarea" rows="5" placeholder="テキストを入力..." aria-label="ペーストするテキスト"></textarea>
      <div class="modal-buttons">
        <button id="paste-cancel" class="modal-btn">キャンセル</button>
        <button id="paste-ok" class="modal-btn primary">OK</button>
      </div>
    </div>
  </div>
  <div id="paste-modal-overlay" class="hidden" aria-hidden="true"></div>

  <!-- セッションタブコンテキストメニュー -->
  <div id="tab-context-menu" class="context-menu hidden" role="menu" aria-label="セッション操作">
    <button class="context-menu-item" id="tab-menu-rename" role="menuitem">
      <i data-lucide="pencil" class="icon"></i>
      <span>名前を変更</span>
    </button>
    <button class="context-menu-item danger" id="tab-menu-delete" role="menuitem">
      <i data-lucide="trash-2" class="icon"></i>
      <span>削除</span>
    </button>
  </div>
  <div id="tab-context-overlay" class="context-overlay hidden" aria-hidden="true"></div>

  <!-- 画像アップロードモーダル -->
  <div id="upload-modal" class="modal hidden" role="dialog" aria-labelledby="upload-modal-title" aria-modal="true">
    <div class="modal-content upload-modal-content">
      <div class="modal-header" id="upload-modal-title">画像をアップロード</div>

      <!-- ファイル選択エリア -->
      <div id="upload-drop-area" class="upload-drop-area">
        <input type="file" id="upload-file-input" accept="image/jpeg,image/png,image/gif,image/webp" hidden>
        <div class="upload-placeholder">
          <i data-lucide="image-plus" class="upload-icon"></i>
          <span class="upload-text">タップして画像を選択</span>
          <span class="upload-hint">JPEG, PNG, GIF, WebP（最大10MB）</span>
        </div>
        <div id="upload-preview" class="upload-preview hidden">
          <img id="upload-preview-img" alt="プレビュー">
          <button id="upload-clear" class="upload-clear-btn" aria-label="選択を解除">
            <i data-lucide="x" class="icon"></i>
          </button>
        </div>
      </div>

      <!-- 進捗表示 -->
      <div id="upload-progress" class="upload-progress hidden">
        <div class="upload-progress-bar">
          <div id="upload-progress-fill" class="upload-progress-fill"></div>
        </div>
        <span id="upload-progress-text">アップロード中...</span>
      </div>

      <!-- 結果表示 -->
      <div id="upload-result" class="upload-result hidden">
        <div class="upload-path-container">
          <code id="upload-path"></code>
          <button id="upload-copy-path" class="upload-copy-btn" aria-label="パスをコピー">
            <i data-lucide="copy" class="icon"></i>
          </button>
        </div>
      </div>

      <div class="modal-buttons">
        <button id="upload-cancel" class="modal-btn">閉じる</button>
        <button id="upload-submit" class="modal-btn primary" disabled>アップロード</button>
        <button id="upload-insert" class="modal-btn primary hidden">ターミナルに入力</button>
      </div>
    </div>
  </div>
  <div id="upload-modal-overlay" class="hidden" aria-hidden="true"></div>

  <!-- ファイルマネージャーモーダル -->
  <div id="fm-modal-overlay" class="hidden" aria-hidden="true"></div>
  <div id="fm-modal" class="hidden" role="dialog" aria-labelledby="fm-title" aria-modal="true">
    <div id="fm-header">
      <button id="fm-back-btn" aria-label="戻る">
        <i data-lucide="arrow-left" class="icon"></i>
      </button>
      <span id="fm-title">ファイルマネージャー</span>
      <div id="fm-header-actions">
        <button id="fm-hidden-toggle" aria-label="隠しファイルを表示" title="隠しファイル表示">
          <i data-lucide="eye-off" class="icon"></i>
        </button>
        <button id="fm-mode-toggle" class="hidden" aria-label="編集モードに切り替え">
          <i data-lucide="pencil" class="icon"></i>
        </button>
        <button id="fm-save-btn" class="hidden" aria-label="保存">
          <i data-lucide="save" class="icon"></i>
        </button>
        <button id="fm-close-btn" aria-label="閉じる">
          <i data-lucide="x" class="icon"></i>
        </button>
      </div>
    </div>
    <div id="fm-browser">
      <div id="fm-breadcrumb"></div>
      <div id="fm-action-bar">
        <button id="fm-upload-btn" class="fm-action-btn">
          <i data-lucide="upload" class="icon"></i>
          <span>アップロード</span>
        </button>
        <button id="fm-new-file-btn" class="fm-action-btn">
          <i data-lucide="file-plus" class="icon"></i>
          <span>新規ファイル</span>
        </button>
      </div>
      <div id="fm-file-list"></div>
      <input type="file" id="fm-file-input" multiple hidden>
    </div>
    <div id="fm-viewer" class="hidden">
      <div id="fm-rendered"></div>
    </div>
    <div id="fm-editor" class="hidden">
      <textarea id="fm-editor-textarea" spellcheck="false"></textarea>
    </div>
  </div>

  <!-- ファイルマネージャー ボトムシートメニュー -->
  <div id="fm-sheet-overlay" class="hidden" aria-hidden="true"></div>
  <div id="fm-bottom-sheet" class="hidden" role="menu" aria-label="ファイル操作">
    <div class="fm-sheet-handle"></div>
    <div id="fm-sheet-filename" class="fm-sheet-title"></div>
    <button class="fm-sheet-item" id="fm-sheet-rename" role="menuitem">
      <i data-lucide="pencil" class="icon"></i>
      <span>名前を変更</span>
    </button>
    <button class="fm-sheet-item" id="fm-sheet-download" role="menuitem">
      <i data-lucide="download" class="icon"></i>
      <span>ダウンロード</span>
    </button>
    <button class="fm-sheet-item fm-sheet-danger" id="fm-sheet-delete" role="menuitem">
      <i data-lucide="trash-2" class="icon"></i>
      <span>削除</span>
    </button>
  </div>

  <script src="/js/terminal.js"></script>
</body>
</html>
